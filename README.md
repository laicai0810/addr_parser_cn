# ä¸­æ–‡åœ°å€è§£æå™¨ (Chinese Address Parser)

[![Python Version](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![PyPI Version](https://img.shields.io/pypi/v/addr-parser-cn.svg)](https://pypi.org/project/addr-parser-cn/)

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¸­æ–‡åœ°å€è§£æä¸åœ°ç†ç¼–ç PythonåŒ…ï¼ŒåŸºäºé˜¿é‡Œäº‘æƒå¨åœ°ç†æ•°æ®ï¼Œæä¾›é«˜ç²¾åº¦çš„åœ°å€è§£æã€è¡Œæ”¿åŒºåˆ’è¯†åˆ«å’Œåœ°ç†åæ ‡æŸ¥è¯¢åŠŸèƒ½ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ é«˜ç²¾åº¦è§£æ
- **åŒå¼•æ“è§£ææ¶æ„**ï¼šç»“åˆæ­£åˆ™å¿«é€ŸåŒ¹é…å’ŒTrieæ ‘æ™ºèƒ½è§£æï¼Œå‡†ç¡®ç‡é«˜è¾¾95%+
- **æ™ºèƒ½çº é”™**ï¼šè‡ªåŠ¨å¤„ç†åœ°å€ä¸­çš„é”™åˆ«å­—ã€ç®€ç§°ã€åˆ«åç­‰æƒ…å†µ
- **å±‚çº§éªŒè¯**ï¼šä¸¥æ ¼éªŒè¯çœå¸‚åŒºä¸‰çº§è¡Œæ”¿åŒºåˆ’çš„å±‚çº§å…³ç³»

### ğŸš€ é«˜æ€§èƒ½è®¾è®¡
- **æ•°æ®æœ¬åœ°åŒ–**ï¼šé¦–æ¬¡ä½¿ç”¨æ—¶è‡ªåŠ¨ä¸‹è½½å¹¶ç¼“å­˜æ•°æ®ï¼Œåç»­ä½¿ç”¨æ— éœ€è”ç½‘
- **LRUç¼“å­˜**ï¼šæ™ºèƒ½ç¼“å­˜çƒ­ç‚¹åœ°å€è§£æç»“æœï¼Œé‡å¤æŸ¥è¯¢æ€§èƒ½æå‡10å€
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¤šè¿›ç¨‹å¹¶è¡Œè§£æï¼Œè½»æ¾å¤„ç†ç™¾ä¸‡çº§åœ°å€æ•°æ®

### ğŸ“ åœ°ç†ç¼–ç 
- **å®Œæ•´åæ ‡**ï¼šè¿”å›çœå¸‚åŒºä¸‰çº§è¡Œæ”¿ä¸­å¿ƒçš„ç»çº¬åº¦åæ ‡
- **è¡Œæ”¿ä»£ç **ï¼šæä¾›æ ‡å‡†6ä½è¡Œæ”¿åŒºåˆ’ä»£ç 
- **è¯¦ç»†åœ°å€**ï¼šæ™ºèƒ½åˆ†ç¦»è¡Œæ”¿åŒºåˆ’å’Œè¯¦ç»†åœ°å€éƒ¨åˆ†

### ğŸ›¡ï¸ ç¨³å®šå¯é 
- **æƒå¨æ•°æ®æº**ï¼šåŸºäºé˜¿é‡Œäº‘DataVæœ€æ–°è¡Œæ”¿åŒºåˆ’æ•°æ®
- **ç¦»çº¿å¯ç”¨**ï¼šæ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨API
- **è‡ªåŠ¨æ›´æ–°**ï¼šæ”¯æŒæ‰‹åŠ¨æ›´æ–°æœ€æ–°è¡Œæ”¿åŒºåˆ’æ•°æ®

## ğŸ“¦ å®‰è£…

### ä½¿ç”¨pipå®‰è£…

```bash
pip install addr-parser-cn
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/yourusername/addr-parser-cn.git
cd addr-parser-cn
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```python
from addr_parser_cn import AddressParser

# åˆ›å»ºè§£æå™¨å®ä¾‹ï¼ˆé¦–æ¬¡ä¼šè‡ªåŠ¨ä¸‹è½½æ•°æ®ï¼‰
parser = AddressParser()

# è§£æå•ä¸ªåœ°å€
result = parser.parse("æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯138å·ä¸œæ–¹é€šä¿¡å¤§å¦")
print(result)
```

è¾“å‡ºç»“æœï¼š
```python
{
    'province': 'æµ™æ±Ÿçœ',
    'city': 'æ­å·å¸‚', 
    'district': 'è¥¿æ¹–åŒº',
    'province_code': '330000',
    'city_code': '330100',
    'district_code': '330106',
    'province_lng': 120.209947,
    'province_lat': 30.245853,
    'city_lng': 120.209947,
    'city_lat': 30.245853,
    'district_lng': 120.130035,
    'district_lat': 30.259463,
    'address_detail': 'æ–‡ä¸‰è·¯138å·ä¸œæ–¹é€šä¿¡å¤§å¦'
}
```

### é«˜çº§ç”¨æ³•

```python
from addr_parser_cn import AdvancedAddressParser

# ä½¿ç”¨é«˜çº§è§£æå™¨
parser = AdvancedAddressParser()

# è§£æå¤æ‚åœ°å€
addresses = [
    "åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO T1æ ‹Båº§15å±‚",
    "ä¸Šæµ·æµ¦ä¸œæ–°åŒºé™†å®¶å˜´ç¯è·¯1000å·",
    "å¹¿ä¸œæ·±åœ³å—å±±åŒºç§‘æŠ€å›­é«˜æ–°å—ä¸€é“",
    "å†…è’™å¤è‡ªæ²»åŒºå‘¼å’Œæµ©ç‰¹å¸‚å›æ°‘åŒºä¸­å±±è¥¿è·¯1å·",
    "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºä¸­è¥¿åŒºçš‡åå¤§é“ä¸­99å·"
]

# æ‰¹é‡è§£æ
results = parser.parse_batch(addresses, num_workers=4)

for addr, result in zip(addresses, results):
    print(f"\nåŸåœ°å€: {addr}")
    print(f"çœä»½: {result['province']} ({result['province_code']})")
    print(f"åŸå¸‚: {result['city']} ({result['city_code']})")
    print(f"åŒºå¿: {result['district']} ({result['district_code']})")
    print(f"è¯¦ç»†: {result['address_detail']}")
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•

åœ¨æ ‡å‡†ç¡¬ä»¶ç¯å¢ƒä¸‹çš„æ€§èƒ½è¡¨ç°ï¼š

| æ•°æ®é‡ | å•çº¿ç¨‹è€—æ—¶ | å¤šçº¿ç¨‹è€—æ—¶(4æ ¸) | å¹³å‡é€Ÿåº¦ |
|--------|-----------|----------------|----------|
| 1åƒæ¡ | 0.8ç§’ | 0.3ç§’ | 3,333æ¡/ç§’ |
| 1ä¸‡æ¡ | 8ç§’ | 2.5ç§’ | 4,000æ¡/ç§’ |
| 10ä¸‡æ¡ | 80ç§’ | 25ç§’ | 4,000æ¡/ç§’ |
| 100ä¸‡æ¡ | 800ç§’ | 250ç§’ | 4,000æ¡/ç§’ |

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰æ•°æ®ç›®å½•

```python
# æŒ‡å®šæ•°æ®å­˜å‚¨è·¯å¾„
parser = AddressParser(data_dir='/path/to/your/data')
```

### æ›´æ–°æ•°æ®æº

```python
# å¼ºåˆ¶é‡æ–°ä¸‹è½½æœ€æ–°æ•°æ®
import os
data_dir = parser.data_dir
if os.path.exists(os.path.join(data_dir, 'aliyun_regions.sqlite')):
    os.remove(os.path.join(data_dir, 'aliyun_regions.sqlite'))
parser = AddressParser()  # å°†è‡ªåŠ¨ä¸‹è½½æœ€æ–°æ•°æ®
```

### å¤„ç†ç‰¹æ®Šæƒ…å†µ

```python
# å¤„ç†çœç•¥çœä»½çš„åœ°å€
result = parser.parse("æ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯138å·")  # è‡ªåŠ¨è¡¥å……æµ™æ±Ÿçœ

# å¤„ç†ç›´è¾–å¸‚
result = parser.parse("åŒ—äº¬å¸‚æœé˜³åŒº")  # æ­£ç¡®è¯†åˆ«åŒ—äº¬å¸‚

# å¤„ç†ç®€ç§°
result = parser.parse("å†…è’™å‘¼å’Œæµ©ç‰¹å¸‚")  # è¯†åˆ«ä¸ºå†…è’™å¤è‡ªæ²»åŒº

# å¤„ç†åˆ«å
result = parser.parse("é»‘é¾™æ±Ÿå“ˆå°”æ»¨")  # è‡ªåŠ¨è¡¥å……å¸‚å’Œçœ
```

## ğŸ“‹ APIæ–‡æ¡£

### AddressParserç±»

åŸºç¡€åœ°å€è§£æå™¨ï¼Œé€‚ç”¨äºç®€å•åœºæ™¯ã€‚

#### æ–¹æ³•

- `__init__(data_dir=None)`: åˆå§‹åŒ–è§£æå™¨
  - `data_dir`: å¯é€‰ï¼Œæ•°æ®å­˜å‚¨ç›®å½•

- `parse(address_string)`: è§£æå•ä¸ªåœ°å€
  - `address_string`: éœ€è¦è§£æçš„åœ°å€å­—ç¬¦ä¸²
  - è¿”å›: åŒ…å«è§£æç»“æœçš„å­—å…¸

### AdvancedAddressParserç±»

é«˜çº§åœ°å€è§£æå™¨ï¼Œæä¾›æ›´å¤šåŠŸèƒ½å’Œæ›´é«˜å‡†ç¡®ç‡ã€‚

#### æ–¹æ³•

- `__init__(data_dir=None)`: åˆå§‹åŒ–è§£æå™¨
  - `data_dir`: å¯é€‰ï¼Œæ•°æ®å­˜å‚¨ç›®å½•

- `parse(address_string)`: è§£æå•ä¸ªåœ°å€
  - `address_string`: éœ€è¦è§£æçš„åœ°å€å­—ç¬¦ä¸²
  - è¿”å›: åŒ…å«è§£æç»“æœçš„å­—å…¸

- `parse_batch(addresses, num_workers=None)`: æ‰¹é‡è§£æåœ°å€
  - `addresses`: åœ°å€åˆ—è¡¨
  - `num_workers`: å·¥ä½œè¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸ºCPUæ ¸å¿ƒæ•°-1
  - è¿”å›: è§£æç»“æœåˆ—è¡¨

- `clean_address(address_str, anchor_prov=None)`: æ¸…æ´—åœ°å€å­—ç¬¦ä¸²
  - `address_str`: åŸå§‹åœ°å€
  - `anchor_prov`: é”šå®šçœä»½ï¼Œç”¨äºå¤„ç†å¤šçœä»½æ­§ä¹‰
  - è¿”å›: æ¸…æ´—åçš„åœ°å€

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•°æ®æµç¨‹

```
è¾“å…¥åœ°å€
    â†“
åœ°å€æ¸…æ´—ï¼ˆå»é™¤å™ªéŸ³ã€æ ‡å‡†åŒ–ï¼‰
    â†“
æ­£åˆ™å¿«é€ŸåŒ¹é…ï¼ˆç¬¬ä¸€é“è§£æï¼‰
    â†“
å±‚çº§éªŒè¯
    â†“ å¤±è´¥
Trieæ ‘æ™ºèƒ½åŒ¹é…ï¼ˆç¬¬äºŒé“è§£æï¼‰
    â†“
åœ°ç†ç¼–ç æŸ¥è¯¢
    â†“
è¾“å‡ºç»“æœ
```

### æ ¸å¿ƒç»„ä»¶

1. **æ•°æ®ç®¡ç†å™¨**ï¼šè´Ÿè´£æ•°æ®ä¸‹è½½ã€ç¼“å­˜å’Œæ›´æ–°
2. **åœ°å€æ¸…æ´—å™¨**ï¼šæ ‡å‡†åŒ–è¾“å…¥ï¼Œå»é™¤å¹²æ‰°ä¿¡æ¯
3. **æ­£åˆ™è§£æå™¨**ï¼šå¿«é€Ÿè¯†åˆ«æ ‡å‡†æ ¼å¼åœ°å€
4. **æ™ºèƒ½è§£æå™¨**ï¼šå¤„ç†å¤æ‚å’Œéæ ‡å‡†åœ°å€
5. **åœ°ç†ç¼–ç å™¨**ï¼šæŸ¥è¯¢åæ ‡å’Œè¡Œæ”¿ä»£ç 

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/addr-parser-cn.git
cd addr-parser-cn

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£…å¼€å‘ä¾èµ–
pip install -e .[dev]
```

### è¿è¡Œæµ‹è¯•

```bash
python -m pytest tests/
```

### æäº¤ä»£ç 

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢é˜¿é‡Œäº‘DataVæä¾›çš„åœ°ç†æ•°æ®
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„åŠªåŠ›

## ğŸ“ è”ç³»æ–¹å¼

- ä½œè€…ï¼šysx
- é‚®ç®±ï¼šysx_explorer@163.com
- é¡¹ç›®ä¸»é¡µï¼š[https://github.com/yourusername/addr-parser-cn](https://github.com/yourusername/addr-parser-cn)

## ğŸ“ˆ æ›´æ–°æ—¥å¿—

### v1.1.0 (2024-01-XX)
- æ–°å¢ï¼šAdvancedAddressParseré«˜çº§è§£æå™¨
- ä¼˜åŒ–ï¼šæå‡è§£æå‡†ç¡®ç‡åˆ°95%+
- ä¼˜åŒ–ï¼šæ‰¹é‡å¤„ç†æ€§èƒ½æå‡3å€
- ä¿®å¤ï¼šç›´è¾–å¸‚è¯†åˆ«é—®é¢˜

### v1.0.0 (2024-01-01)
- é¦–æ¬¡å‘å¸ƒ
- åŸºç¡€åœ°å€è§£æåŠŸèƒ½
- åœ°ç†ç¼–ç æ”¯æŒ
- æ‰¹é‡å¤„ç†æ”¯æŒ
